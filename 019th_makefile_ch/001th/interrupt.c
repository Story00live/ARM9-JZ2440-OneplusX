/**
  *********************************************************************************************************
  * @file    interrupt.c
  * @author  Devilhart -- KK
  * @version V0.0.1
  * @date    2019-03-10
  * @brief   1TAB = 5Speace
  *********************************************************************************************************
  * @attention
  *					 
  *					 
  *********************************************************************************************************
  */

#include "interrupt.h"

S3C2440_IRQ_Function			S3C2440_IRQ_Func_Array[32];					//32个中断源执行函数数组

/**
  *********************************************************************************************************
  * SRCPND 用来显示哪个中断产生了, 需要清除对应位
  * bit0-EINT0
  * bit2-EINT2
  * bit5-EINT8_23
  *********************************************************************************************************
  */

/**
  *********************************************************************************************************
  * INTMSK 用来屏蔽中断, 1-masked
  * bit0-EINT0
  * bit2-EINT2
  * bit5-EINT8_23
  *********************************************************************************************************
  */

/**
  *********************************************************************************************************
  * INTPND 用来显示当前优先级最高的, 正在发生的中断, 需要清除对应位
  * bit0-EINT0
  * bit2-EINT2
  * bit5-EINT8_23
  *********************************************************************************************************
  */

/**
  *********************************************************************************************************
  * INTOFFSET : 用来显示INTPND中哪一位被设置为1
  *********************************************************************************************************
  */

#if 0
/**********************************************************************************************************
 @Function			void S3C2440_IRQInitialized(void)
 @Description			S3C2440_IRQInitialized		: 中断控制器初始化
 @Input				void
 @Return				void
**********************************************************************************************************/
void S3C2440_IRQInitialized(void)
{
	INTMSK &= ~((1<<0) | (1<<2) | (1<<5));									/* 开启EINT0, EINT2, EINT8_23中断源 */
	INTMSK &= ~(1<<10);													/* 开启INT_TIMER0中断源 */
}
#endif

/**********************************************************************************************************
 @Function			void S3C2440_IRQRegister(unsigned char irqChannel, S3C2440_IRQ_Function fd)
 @Description			S3C2440_IRQRegister			: 注册中断源
 @Input				irqChannel				: 中断号
					fd						: 中断执行函数
 @Return				void
**********************************************************************************************************/
void S3C2440_IRQRegister(unsigned char irqChannel, S3C2440_IRQ_Function fd)
{
	S3C2440_IRQ_Func_Array[irqChannel] = fd;								/* 配置中断执行函数 */
	
	INTMSK &= ~(1<<irqChannel);											/* 开启对应中断服务 */
}

/**********************************************************************************************************
 @Function			void S3C2440_IRQHandler(void)
 @Description			S3C2440_IRQHandler			: 中断处理函数
 @Input				void
 @Return				void
**********************************************************************************************************/
void S3C2440_IRQHandler(void)
{
	/* 分辨中断源 */
	unsigned int irqSrcBit = INTOFFSET;
	
	/* 调用对应处理函数 */
	S3C2440_IRQ_Func_Array[irqSrcBit](irqSrcBit);							/* 处理中断 */
	
	/* 清中断 */
	SRCPND = (1<<irqSrcBit);
	INTPND = (1<<irqSrcBit);
}

/********************************************** END OF FLEE **********************************************/
